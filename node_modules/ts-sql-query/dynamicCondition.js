"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.expandTypeFromDynamicPickPaths = exports.dynamicPickPaths = exports.dynamicPick = void 0;
const values_1 = require("./expressions/values");
// type ExpandRecursively<T> = T extends object ? T extends infer O ? { [K in keyof O]: ExpandRecursively<O[K]> } : never : T;
function dynamicPick(obj, pick, mandatory) {
    const result = {};
    const required = {};
    if (mandatory) {
        for (let i = 0, length = mandatory.length; i < length; i++) {
            required[mandatory[i]] = true;
        }
    }
    const o = obj;
    const p = pick;
    for (let prop in o) {
        if (!o[prop]) {
            // Do nothing
        }
        else if (prop in required) {
            result[prop] = o[prop];
        }
        else {
            const isRequired = p[prop];
            if (isRequired === true) {
                result[prop] = o[prop];
            }
            else if (!isRequired) {
                // Do nothing
            }
            else if (typeof isRequired === 'object') {
                result[prop] = internalDynamicPick(o[prop], isRequired, required, prop);
            }
        }
    }
    return result;
}
exports.dynamicPick = dynamicPick;
function internalDynamicPick(o, p, required, prefix) {
    const result = {};
    for (let prop in o) {
        if (!o[prop]) {
            // Do nothing
        }
        else if ((prefix + '.' + prop) in required) {
            result[prop] = o[prop];
        }
        else {
            const isRequired = p[prop];
            if (isRequired === true) {
                result[prop] = o[prop];
            }
            else if (!isRequired) {
                // Do nothing
            }
            else if (typeof isRequired === 'object') {
                result[prop] = internalDynamicPick(o[prop], isRequired, required, prefix + '.' + prop);
            }
        }
    }
    return result;
}
function dynamicPickPaths(obj, pick, mandatory) {
    const result = {};
    const required = {};
    if (mandatory) {
        for (let i = 0, length = mandatory.length; i < length; i++) {
            required[mandatory[i]] = true;
        }
    }
    if (pick) {
        for (let i = 0, length = pick.length; i < length; i++) {
            required[pick[i]] = true;
        }
    }
    const o = obj;
    for (let prop in o) {
        console.log('>', prop);
        if (!o[prop]) {
            // Do nothing
        }
        else if (prop in required) {
            result[prop] = o[prop];
        }
        else if ((0, values_1.isValueSource)(o[prop])) {
            const r = internalDynamicPickPaths(o[prop], required, prop);
            if (r !== undefined) {
                result[prop] = r;
            }
        }
    }
    return result;
}
exports.dynamicPickPaths = dynamicPickPaths;
function internalDynamicPickPaths(o, required, prefix) {
    if (!o) {
        return undefined;
    }
    const result = {};
    for (let prop in o) {
        console.log('>', prefix, prop);
        if (!o[prop]) {
            // Do nothing
        }
        else if ((prefix + '.' + prop) in required) {
            result[prop] = o[prop];
        }
        else if ((0, values_1.isValueSource)(o[prop])) {
            const r = internalDynamicPickPaths(o[prop], required, prefix + '.' + prop);
            if (r !== undefined) {
                result[prop] = r;
            }
        }
    }
    return result;
}
function expandTypeFromDynamicPickPaths(obj, pick, result) {
    obj;
    pick;
    return result;
}
exports.expandTypeFromDynamicPickPaths = expandTypeFromDynamicPickPaths;
